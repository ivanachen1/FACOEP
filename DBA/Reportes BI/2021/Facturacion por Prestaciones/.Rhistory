fecha_inicio <- floor_date(fecha_actual,unit =  'month')
start_date <- floor_date(fecha_actual,unit =  'month')
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
#fecha_actual <- as.Date("2022-01-31")
fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
#fecha_actual <- as.Date("2022-01-31")
fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
fecha_actual <- as.Date("2022-04-01")
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_actual,unit =  'month')}
fecha_inicio <- ceiling_date(fecha_actual,unit =  'month')}
fecha_actual <- as.Date("2022-04-01")
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- ceiling_date(fecha_actual,unit =  'month')}
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- ceiling_date(fecha_actual,unit =  'month')}
fecha_inicio <- floor_date(fecha_actual,unit =  'month')}
fecha_inicio <- floor_date(fecha_actual,unit =  'month')}
fecha_actual <- as.Date("2022-04-01")
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_actual,unit =  'month')}
fecha_actual <- as.Date("2022-04-01")
start_date <- floor_date(fecha_actual,unit =  'month')
end_date <- ceiling_date(fecha_actual,unit =  'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_actual,unit =  'month')} - 1
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(Sys.Date() %m-% months(1), 'month')
end_date <- ceiling_date(Sys.Date() %m-% months(1), 'month') %m-% days(1) 1
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(Sys.Date() %m-% months(1), 'month')
end_date <- ceiling_date(Sys.Date() %m-% months(1), 'month') %m-% days(1)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual %m-% months(1), 'month')
end_date <- ceiling_date(fecha_actual %m-% months(1), 'month') %m-% days(1)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month')
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-30")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
fecha_actual <- as.Date("2022-04-15")
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- fecha_actual
fecha_fin <- ceiling_date(fecha_fin %m-% days(1), 'month') %m-% days(1)}
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-15")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
nombre_archivo <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[2]]
CreateFile(query = query,
con = con,
nombre_archivo = nombre_archivo,
workdirectory = workdirectory)
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
CreateFile(query = query,
con = con,
nombre_archivo = nombre_archivo,
workdirectory = workdirectory)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
nombre_archivo <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[2]]
CreateFile(query = query,
con = con,
nombre_archivo = nombre_archivo,
workdirectory = workdirectory)
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
data <- dbGetQuery(con,query)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
nombre_archivo <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[2]]
setwd(workdirectory)
data <- dbGetQuery(con,query)
if(nrow(data) == 0){
write.csv(data,nombre_archivo)}
if(nrow(data)>0){
data$cantidad <- 1
data$emision <- as.Date(data$emision)
write.csv(data,nombre_archivo)}
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
data <- dbGetQuery(con,query)
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-04-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
nombre_archivo <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[2]]
setwd(workdirectory)
data <- dbGetQuery(con,query)
if(nrow(data) == 0){
write.csv(data,nombre_archivo)}
if(nrow(data)>0){
data$cantidad <- 1
data$emision <- as.Date(data$emision)
write.csv(data,nombre_archivo)}
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#pw <- {"odoo"}
pw <- {"odoo"}
drv <- dbDriver("PostgreSQL")
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "172.31.24.12", port = 5432,
#                 user = "postgres", password = pw)
con <- dbConnect(drv, dbname = "facoep",
host = "localhost", port = 5432,
user = "odoo",password = pw)
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
fecha_actual <- as.Date("2022-02-01")
#fecha_actual <- Sys.Date()
start_date <- floor_date(fecha_actual, 'month')
end_date <- ceiling_date(fecha_actual, 'month') - 1
if(fecha_actual == start_date){
print("entro a la condicion 1")
fecha_fin <- fecha_actual - 1
fecha_inicio <- floor_date(fecha_fin, 'month')}
if(fecha_actual == end_date){
print("entro a la condicion 2")
fecha_fin <- fecha_actual
fecha_inicio <- floor_date(fecha_fin %m-% days(1), 'month')}
if(fecha_actual != start_date & fecha_actual != end_date){
print("entro a la condicion 3")
fecha_inicio <- start_date
fecha_fin <- fecha_actual}
query <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[1]]
nombre_archivo <- GetQuery(fecha_actual = fecha_fin,
fecha_anterior = fecha_inicio)[[2]]
setwd(workdirectory)
data <- dbGetQuery(con,query)
if(nrow(data) == 0){
write.csv(data,nombre_archivo)}
if(nrow(data)>0){
data$cantidad <- 1
data$emision <- as.Date(data$emision)
write.csv(data,nombre_archivo)}
# Cierra todo
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#source("E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado")
drv <- dbDriver("PostgreSQL")
#pw <- {"odoo"}
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "localhost", port = 5432,
#                 user = "odoo",password = pw)
pw <- {"serveradmin"}
con <- dbConnect(drv, dbname = "Facoep",
host = "10.22.0.142", port = 5432,
user = "postgres", password = pw)
Efectores <- dbGetQuery(conn = con,"SELECT DISTINCT pprnombre as efectores FROM proveedorprestador")
View(Efectores)
Efectores <- dbGetQuery(conn = con,"SELECT DISTINCT pprid,pprnombre as efectores FROM proveedorprestador")
View(Efectores)
View(GetParameter)
GetFile <- function(file_name,path_one,path_two){
intento  <- is.error(try(read.xlsx(paste(path_two,file_name,sep = "/")),silent = F,outFile = "Error"))
if(intento == TRUE){
return(read.xlsx(paste(path_one,file_name,sep = "/")))} else {return(read.xlsx(paste(path_two,file_name,sep = "/")))}
}
Years <-GetFile("years.xlsx",path_one = workdirectory,path_two = workdirectory)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#source("E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado")
workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
#workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
drv <- dbDriver("PostgreSQL")
#pw <- {"odoo"}
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "localhost", port = 5432,
#                 user = "odoo",password = pw)
pw <- {"serveradmin"}
con <- dbConnect(drv, dbname = "Facoep",
host = "10.22.0.142", port = 5432,
user = "postgres", password = pw)
Efectores <- dbGetQuery(conn = con,"SELECT DISTINCT pprid,pprnombre as efectores FROM proveedorprestador")
Years <-GetFile("years.xlsx",path_one = workdirectory,path_two = workdirectory)
source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
#source("E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado")
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
drv <- dbDriver("PostgreSQL")
#pw <- {"odoo"}
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "localhost", port = 5432,
#                 user = "odoo",password = pw)
pw <- {"serveradmin"}
con <- dbConnect(drv, dbname = "Facoep",
host = "10.22.0.142", port = 5432,
user = "postgres", password = pw)
Efectores <- dbGetQuery(conn = con,"SELECT DISTINCT pprid,pprnombre as efectores FROM proveedorprestador")
Years <-GetFile("years.xlsx",path_one = workdirectory,path_two = workdirectory)
View(Years)
#source("C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones/FuncionesHelper.R")
source("E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/FuncionesHelper.R")
#workdirectory <- "E:/Personales/Sistemas/Agustin/Reportes BI/2021/Facturación/Automatizado/data/excels"
workdirectory <- "C:/Users/iachenbach/Gobierno de la Ciudad de Buenos Aires/Pablo Alfredo Gadea - Tablero Facoep P BI/FACOEP/DBA/Reportes BI/2021/Facturacion por Prestaciones"
drv <- dbDriver("PostgreSQL")
#pw <- {"odoo"}
#con <- dbConnect(drv, dbname = "facoep",
#                 host = "localhost", port = 5432,
#                 user = "odoo",password = pw)
pw <- {"serveradmin"}
con <- dbConnect(drv, dbname = "Facoep",
host = "10.22.0.142", port = 5432,
user = "postgres", password = pw)
Efectores <- dbGetQuery(conn = con,"SELECT DISTINCT pprnombre as efectores FROM proveedorprestador")
lapply(dbListConnections(drv = dbDriver("PostgreSQL")), function(x) {dbDisconnect(conn = x)})
Years <-GetFile("years.xlsx",path_one = workdirectory,path_two = workdirectory)
View(Efectores)
